<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è€ƒå‹¤ä»ªè¡¨ç›˜åŠ è½½çŠ¶æ€è°ƒè¯•</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: #f8fafc;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .debug-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
        }
        .result { 
            margin-top: 10px; 
            padding: 15px; 
            background: #f1f5f9; 
            border-radius: 6px; 
            white-space: pre-wrap; 
            font-family: monospace; 
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        .success { border-left: 4px solid #059669; }
        .error { border-left: 4px solid #dc2626; }
        .info { border-left: 4px solid #0284c7; }
        .warning { border-left: 4px solid #d97706; }
        button { 
            padding: 8px 16px; 
            margin: 5px; 
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: white;
            cursor: pointer;
        }
        button:hover {
            background: #f9fafb;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-loading { background: #f59e0b; }
        .status-success { background: #059669; }
        .status-error { background: #dc2626; }
        .checklist {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” è€ƒå‹¤ä»ªè¡¨ç›˜åŠ è½½çŠ¶æ€è°ƒè¯•</h1>
        
        <div class="checklist">
            <h3>ğŸ“‹ åŠ è½½çŠ¶æ€æ£€æŸ¥æ¸…å•</h3>
            <div id="loadingChecklist">
                <div><span class="status-indicator status-loading"></span>è§„åˆ™é…ç½®åŠ è½½ (ruleConfigLoaded)</div>
                <div><span class="status-indicator status-loading"></span>ç”¨æˆ·æ•°æ®åŠ è½½ (allUsers.length > 0)</div>
                <div><span class="status-indicator status-loading"></span>è€ƒå‹¤åœ°å›¾åˆå§‹åŒ– (attendanceMap)</div>
                <div><span class="status-indicator status-loading"></span>ç»Ÿè®¡æ•°æ®è®¡ç®— (companyEmployeeStats)</div>
                <div><span class="status-indicator status-loading"></span>åŸºç¡€åŠ è½½çŠ¶æ€ (!isLoading && !isRefreshing)</div>
            </div>
        </div>
        
        <div class="debug-section">
            <h3>ğŸ§ª è°ƒè¯•å·¥å…·</h3>
            <button onclick="checkConsoleLog()">æ£€æŸ¥æ§åˆ¶å°æ—¥å¿—</button>
            <button onclick="simulateLoadingSteps()">æ¨¡æ‹ŸåŠ è½½æ­¥éª¤</button>
            <button onclick="analyzeLoadingIssues()">åˆ†æåŠ è½½é—®é¢˜</button>
            <button onclick="clearResults()">æ¸…é™¤ç»“æœ</button>
        </div>
        
        <div class="debug-section">
            <h3>ğŸ”§ å¯èƒ½çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ</h3>
            <div class="result info">
å¸¸è§çš„åŠ è½½å¡ä½åŸå› ï¼š

1. ğŸ”„ è§„åˆ™é…ç½®åŠ è½½å¤±è´¥
   - æ£€æŸ¥: initRuleConfigCache() æ˜¯å¦æˆåŠŸ
   - è§£å†³: æŸ¥çœ‹ç½‘ç»œè¯·æ±‚æ˜¯å¦æ­£å¸¸

2. ğŸ“Š APIæ•°æ®è·å–å¤±è´¥
   - æ£€æŸ¥: fetchCompanyData() æ˜¯å¦è¿”å›æ•°æ®
   - è§£å†³: æŸ¥çœ‹APIå“åº”çŠ¶æ€å’Œæ•°æ®æ ¼å¼

3. ğŸ—ºï¸ è€ƒå‹¤åœ°å›¾åˆå§‹åŒ–å¡ä½
   - æ£€æŸ¥: allUsers æ˜¯å¦æœ‰ punchData
   - è§£å†³: ç¡®è®¤ç”¨æˆ·æ•°æ®åŒ…å«è€ƒå‹¤è®°å½•

4. ğŸ“ˆ ç»Ÿè®¡æ•°æ®è®¡ç®—å¼‚å¸¸
   - æ£€æŸ¥: useAttendanceStats æ˜¯å¦è¿”å›æ•°æ®
   - è§£å†³: æŸ¥çœ‹ç»Ÿè®¡è®¡ç®—çš„è¾“å…¥å‚æ•°

5. ğŸ”’ åŠ è½½çŠ¶æ€åˆ¤æ–­è¿‡äºä¸¥æ ¼
   - æ£€æŸ¥: isDataLoading çš„åˆ¤æ–­æ¡ä»¶
   - è§£å†³: æ”¾å®½æŸäº›æ£€æŸ¥æ¡ä»¶
            </div>
        </div>
        
        <div id="results"></div>
    </div>

    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = message;
            results.appendChild(div);
            results.scrollTop = results.scrollHeight;
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }
        
        function updateChecklistItem(index, status) {
            const items = document.querySelectorAll('#loadingChecklist .status-indicator');
            if (items[index]) {
                items[index].className = `status-indicator status-${status}`;
            }
        }

        function checkConsoleLog() {
            log('ğŸ” æ£€æŸ¥æ§åˆ¶å°æ—¥å¿—...', 'info');
            log('', 'info');
            log('è¯·æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·çš„æ§åˆ¶å°ï¼ŒæŸ¥æ‰¾ä»¥ä¸‹å…³é”®æ—¥å¿—:', 'info');
            log('', 'info');
            log('1. [AttendanceDashboardPage] è§„åˆ™é…ç½®ç¼“å­˜å·²åˆå§‹åŒ–', 'info');
            log('2. [AttendanceDashboardPage] è§„åˆ™é…ç½®å·²åŠ è½½ï¼Œå¼€å§‹åŠ è½½æ•°æ®', 'info');
            log('3. [AttendanceDashboardPage] ä»APIåŠ è½½æ•°æ®: eyewind/hydodo', 'info');
            log('4. [AttendanceDashboardPage] æ•°æ®åŠ è½½å®Œæˆ: X ä¸ªç”¨æˆ·', 'info');
            log('5. [AttendanceDashboardPage] å¼€å§‹åˆå§‹åŒ–è€ƒå‹¤åœ°å›¾: X ä¸ªç”¨æˆ·', 'info');
            log('6. [AttendanceDashboardPage] è€ƒå‹¤åœ°å›¾åˆå§‹åŒ–å®Œæˆ: X ä¸ªç”¨æˆ·', 'info');
            log('7. [AttendanceDashboardPage] æ£€æŸ¥æ•°æ®åŠ è½½çŠ¶æ€: {...}', 'info');
            log('', 'info');
            log('å¦‚æœæŸä¸ªæ­¥éª¤çš„æ—¥å¿—æ²¡æœ‰å‡ºç°ï¼Œè¯´æ˜åœ¨è¯¥æ­¥éª¤å¡ä½äº†ã€‚', 'warning');
        }

        function simulateLoadingSteps() {
            log('ğŸ”„ æ¨¡æ‹ŸåŠ è½½æ­¥éª¤...', 'info');
            
            let step = 0;
            const steps = [
                { name: 'åˆå§‹åŒ–è§„åˆ™é…ç½®', time: 500 },
                { name: 'åŠ è½½ç”¨æˆ·æ•°æ®', time: 1000 },
                { name: 'åˆå§‹åŒ–è€ƒå‹¤åœ°å›¾', time: 800 },
                { name: 'è®¡ç®—ç»Ÿè®¡æ•°æ®', time: 1200 },
                { name: 'å®ŒæˆåŠ è½½', time: 200 }
            ];
            
            function nextStep() {
                if (step < steps.length) {
                    const currentStep = steps[step];
                    log(`æ­¥éª¤ ${step + 1}: ${currentStep.name}...`, 'info');
                    updateChecklistItem(step, 'success');
                    
                    setTimeout(() => {
                        step++;
                        nextStep();
                    }, currentStep.time);
                } else {
                    log('âœ… æ‰€æœ‰æ­¥éª¤å®Œæˆï¼', 'success');
                }
            }
            
            nextStep();
        }

        function analyzeLoadingIssues() {
            log('ğŸ” åˆ†æå¯èƒ½çš„åŠ è½½é—®é¢˜...', 'info');
            log('', 'info');
            
            // æ¨¡æ‹Ÿä¸åŒçš„é—®é¢˜åœºæ™¯
            const issues = [
                {
                    name: 'è§„åˆ™é…ç½®åŠ è½½å¤±è´¥',
                    symptoms: ['é¡µé¢ä¸€ç›´æ˜¾ç¤ºåŠ è½½ä¸­', 'æ§åˆ¶å°æ²¡æœ‰"è§„åˆ™é…ç½®ç¼“å­˜å·²åˆå§‹åŒ–"æ—¥å¿—'],
                    causes: ['ç½‘ç»œè¯·æ±‚å¤±è´¥', 'APIæœåŠ¡å™¨å¼‚å¸¸', 'é…ç½®æ–‡ä»¶æ ¼å¼é”™è¯¯'],
                    solutions: ['æ£€æŸ¥ç½‘ç»œè¿æ¥', 'é‡å¯æœåŠ¡å™¨', 'éªŒè¯é…ç½®æ–‡ä»¶æ ¼å¼']
                },
                {
                    name: 'APIæ•°æ®è·å–å¤±è´¥',
                    symptoms: ['æœ‰è§„åˆ™é…ç½®æ—¥å¿—ä½†æ²¡æœ‰æ•°æ®åŠ è½½æ—¥å¿—', 'ç½‘ç»œé¢æ¿æ˜¾ç¤ºAPIè¯·æ±‚å¤±è´¥'],
                    causes: ['APIæœåŠ¡å™¨å®•æœº', 'è®¤è¯å¤±è´¥', 'å‚æ•°é”™è¯¯'],
                    solutions: ['æ£€æŸ¥APIæœåŠ¡å™¨çŠ¶æ€', 'éªŒè¯è®¤è¯ä¿¡æ¯', 'æ£€æŸ¥è¯·æ±‚å‚æ•°']
                },
                {
                    name: 'è€ƒå‹¤åœ°å›¾åˆå§‹åŒ–å¡ä½',
                    symptoms: ['æœ‰ç”¨æˆ·æ•°æ®ä½†æ²¡æœ‰è€ƒå‹¤åœ°å›¾æ—¥å¿—', 'ç”¨æˆ·æ•°æ®æ²¡æœ‰punchData'],
                    causes: ['ç”¨æˆ·æ•°æ®æ ¼å¼é”™è¯¯', 'è€ƒå‹¤è®°å½•ä¸ºç©º', 'æ—¥æœŸè®¡ç®—å¼‚å¸¸'],
                    solutions: ['æ£€æŸ¥ç”¨æˆ·æ•°æ®ç»“æ„', 'éªŒè¯è€ƒå‹¤è®°å½•', 'æ£€æŸ¥æ—¥æœŸå¤„ç†é€»è¾‘']
                },
                {
                    name: 'ç»Ÿè®¡æ•°æ®è®¡ç®—å¼‚å¸¸',
                    symptoms: ['æœ‰è€ƒå‹¤åœ°å›¾ä½†ç»Ÿè®¡æ•°æ®ä¸ºç©º', 'useAttendanceStatsè¿”å›ç©ºå¯¹è±¡'],
                    causes: ['ç»Ÿè®¡è®¡ç®—é€»è¾‘é”™è¯¯', 'æ•°æ®æ ¼å¼ä¸åŒ¹é…', 'è§„åˆ™å¼•æ“å¼‚å¸¸'],
                    solutions: ['æ£€æŸ¥ç»Ÿè®¡è®¡ç®—é€»è¾‘', 'éªŒè¯æ•°æ®æ ¼å¼', 'é‡ç½®è§„åˆ™å¼•æ“']
                },
                {
                    name: 'åŠ è½½çŠ¶æ€åˆ¤æ–­è¿‡äºä¸¥æ ¼',
                    symptoms: ['æ‰€æœ‰æ•°æ®éƒ½æœ‰ä½†ä»æ˜¾ç¤ºåŠ è½½ä¸­', 'isDataLoadingå§‹ç»ˆä¸ºtrue'],
                    causes: ['åˆ¤æ–­æ¡ä»¶è¿‡äºä¸¥æ ¼', 'æŸä¸ªæ¡ä»¶æ°¸è¿œä¸æ»¡è¶³', 'çŠ¶æ€æ›´æ–°å¼‚å¸¸'],
                    solutions: ['æ”¾å®½åˆ¤æ–­æ¡ä»¶', 'æ·»åŠ è°ƒè¯•æ—¥å¿—', 'æ£€æŸ¥çŠ¶æ€æ›´æ–°é€»è¾‘']
                }
            ];
            
            issues.forEach((issue, index) => {
                log(`é—®é¢˜ ${index + 1}: ${issue.name}`, 'warning');
                log(`ç—‡çŠ¶: ${issue.symptoms.join(', ')}`, 'info');
                log(`å¯èƒ½åŸå› : ${issue.causes.join(', ')}`, 'info');
                log(`è§£å†³æ–¹æ¡ˆ: ${issue.solutions.join(', ')}`, 'success');
                log('', 'info');
            });
            
            log('ğŸ”§ è°ƒè¯•å»ºè®®:', 'info');
            log('1. æŒ‰é¡ºåºæ£€æŸ¥æ¯ä¸ªåŠ è½½æ­¥éª¤çš„æ—¥å¿—', 'info');
            log('2. åœ¨å¡ä½çš„æ­¥éª¤æ·»åŠ æ›´å¤šè°ƒè¯•ä¿¡æ¯', 'info');
            log('3. æ£€æŸ¥ç½‘ç»œé¢æ¿çš„APIè¯·æ±‚çŠ¶æ€', 'info');
            log('4. éªŒè¯æ•°æ®æ ¼å¼å’Œç»“æ„', 'info');
            log('5. è€ƒè™‘æ”¾å®½åŠ è½½çŠ¶æ€çš„åˆ¤æ–­æ¡ä»¶', 'info');
        }

        // é¡µé¢åŠ è½½æ—¶çš„åˆå§‹åŒ–
        window.onload = function() {
            log('è€ƒå‹¤ä»ªè¡¨ç›˜åŠ è½½çŠ¶æ€è°ƒè¯•å·¥å…·å·²åŠ è½½', 'success');
            log('', 'info');
            log('ğŸ¯ è°ƒè¯•ç›®æ ‡:', 'info');
            log('â€¢ æ‰¾å‡ºé¡µé¢ä¸€ç›´åŠ è½½ä¸­çš„åŸå› ', 'warning');
            log('â€¢ ç¡®å®šæ˜¯ç¼“å­˜é—®é¢˜è¿˜æ˜¯æ•°æ®åŒ¹é…é—®é¢˜', 'warning');
            log('â€¢ æä¾›å…·ä½“çš„è§£å†³æ–¹æ¡ˆ', 'warning');
            log('', 'info');
            log('ğŸ” è°ƒè¯•æ–¹æ³•:', 'info');
            log('â€¢ æ£€æŸ¥æ§åˆ¶å°æ—¥å¿—æ‰¾å‡ºå¡ä½çš„æ­¥éª¤', 'success');
            log('â€¢ åˆ†æå¯èƒ½çš„é—®é¢˜åŸå› ', 'success');
            log('â€¢ éªŒè¯æ•°æ®åŠ è½½å’Œå¤„ç†æµç¨‹', 'success');
            log('', 'info');
            log('ç°åœ¨å¯ä»¥å¼€å§‹è°ƒè¯•...', 'info');
        };
    </script>
</body>
</html>