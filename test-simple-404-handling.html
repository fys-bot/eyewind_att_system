<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®€åŒ–404å¤„ç†æµ‹è¯•</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: #f8fafc;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .simple-approach {
            background: #dcfce7;
            border: 1px solid #16a34a;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
        }
        .log { 
            background: #f1f5f9; 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 4px; 
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        .success { color: #059669; }
        .info { color: #0284c7; }
        .warning { color: #d97706; }
        .error { color: #dc2626; }
        button { 
            padding: 8px 16px; 
            margin: 5px; 
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: white;
            cursor: pointer;
        }
        button:hover {
            background: #f9fafb;
        }
        .code-block {
            background: #1e293b;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
            margin: 10px 0;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ ç®€åŒ–404å¤„ç†æ–¹æ¡ˆæµ‹è¯•</h1>
        
        <div class="simple-approach">
            <h3>âœ… ç®€åŒ–æ–¹æ¡ˆ</h3>
            <p><strong>æ ¸å¿ƒæ€è·¯ï¼š</strong>ä¸è¦è¿‡åº¦å¤æ‚åŒ–ï¼Œç›´æ¥å¤„ç†é”™è¯¯æƒ…å†µ</p>
            
            <h4>ğŸ”§ ç®€åŒ–é€»è¾‘ï¼š</h4>
            <ol>
                <li><strong>404å“åº”ï¼š</strong>ç›´æ¥è®¾ç½®é”™è¯¯ä¿¡æ¯ï¼Œæ˜¾ç¤º"å½“å‰æœˆä»½æ²¡æœ‰è€ƒå‹¤æ•°æ®"</li>
                <li><strong>success=falseï¼š</strong>ç›´æ¥è®¾ç½®é”™è¯¯ä¿¡æ¯ï¼Œæ˜¾ç¤ºAPIè¿”å›çš„é”™è¯¯æ¶ˆæ¯</li>
                <li><strong>æ— æ•°æ®ï¼š</strong>ç›´æ¥è®¾ç½®é”™è¯¯ä¿¡æ¯ï¼Œæ˜¾ç¤º"APIè¿”å›æ— æ•°æ®"</li>
                <li><strong>æ‰€æœ‰é”™è¯¯æƒ…å†µï¼š</strong>éƒ½ç›´æ¥returnï¼Œä¸ç»§ç»­å¤„ç†æ•°æ®</li>
                <li><strong>finallyå—ï¼š</strong>ç¡®ä¿loadingçŠ¶æ€æ€»æ˜¯è¢«æ­£ç¡®è®¾ç½®ä¸ºfalse</li>
            </ol>
        </div>
        
        <div class="test-section">
            <h3>ğŸ§ª ç®€åŒ–é€»è¾‘æµ‹è¯•</h3>
            <button onclick="testSimple404()">æµ‹è¯•404å¤„ç†</button>
            <button onclick="testSimpleSuccess()">æµ‹è¯•æˆåŠŸå“åº”</button>
            <button onclick="testSimpleError()">æµ‹è¯•é”™è¯¯å“åº”</button>
            <button onclick="clearLogs()">æ¸…é™¤æ—¥å¿—</button>
        </div>
        
        <div class="test-section">
            <h3>ğŸ“‹ ç®€åŒ–å‰åå¯¹æ¯”</h3>
            
            <h4>å¤æ‚çš„æ—§é€»è¾‘ï¼ˆæœ‰é—®é¢˜ï¼‰ï¼š</h4>
            <div class="code-block">
// âŒ å¤æ‚çš„å¤„ç†é€»è¾‘
if (response.status === 404) {
    // å¤„ç†404ï¼Œä½†ä¸returnï¼Œç»§ç»­æ‰§è¡Œåé¢çš„ä»£ç 
    // å¯èƒ½å¯¼è‡´è®¿é—®ä¸å­˜åœ¨çš„æ•°æ®ç»“æ„
} else if (!response.ok) {
    throw new Error(...);
} else {
    // å¤„ç†æˆåŠŸå“åº”
    if (!apiResponse.success || !apiResponse.data) {
        // åˆæ˜¯ä¸€å±‚å¤æ‚çš„å¤„ç†
        // ä¸returnï¼Œç»§ç»­æ‰§è¡Œ
    } else {
        // å¤æ‚çš„æ•°æ®å¤„ç†é€»è¾‘
    }
}
            </div>
            
            <h4>ç®€åŒ–çš„æ–°é€»è¾‘ï¼ˆæ¸…æ™°ï¼‰ï¼š</h4>
            <div class="code-block">
// âœ… ç®€åŒ–çš„å¤„ç†é€»è¾‘
if (response.status === 404) {
    const errorData = await response.json();
    setSheetsError(errorData.message || 'å½“å‰æœˆä»½æ²¡æœ‰è€ƒå‹¤æ•°æ®');
    setSheets([]);
    return; // ç›´æ¥è¿”å›ï¼Œä¸å¤„ç†æ•°æ®
}

if (!response.ok) {
    throw new Error(`APIè¯·æ±‚å¤±è´¥: ${response.status}`);
}

const apiResponse = await response.json();

if (!apiResponse.success) {
    setSheetsError(apiResponse.message || 'APIè¿”å›å¤±è´¥çŠ¶æ€');
    setSheets([]);
    return; // ç›´æ¥è¿”å›ï¼Œä¸å¤„ç†æ•°æ®
}

if (!apiResponse.data) {
    setSheetsError('APIè¿”å›æ— æ•°æ®');
    setSheets([]);
    return; // ç›´æ¥è¿”å›ï¼Œä¸å¤„ç†æ•°æ®
}

// åªæœ‰åœ¨å®Œå…¨æˆåŠŸæ—¶æ‰å¤„ç†æ•°æ®
// å¤„ç†æ•°æ®é€»è¾‘...
            </div>
        </div>
        
        <div id="logs"></div>
    </div>

    <script>
        function log(message, type = 'info') {
            const logs = document.getElementById('logs');
            const div = document.createElement('div');
            div.className = `log ${type}`;
            div.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            logs.appendChild(div);
            logs.scrollTop = logs.scrollHeight;
        }

        function clearLogs() {
            document.getElementById('logs').innerHTML = '';
        }

        async function testSimple404() {
            log('ğŸ§ª å¼€å§‹æµ‹è¯•ç®€åŒ–çš„404å¤„ç†...', 'info');
            
            try {
                const response = await fetch('/api/v1/attendance/status/load/2026-01');
                log(`å“åº”çŠ¶æ€: ${response.status}`, 'info');
                
                if (response.status === 404) {
                    const errorData = await response.json();
                    log('âœ… 404å¤„ç†é€»è¾‘:', 'success');
                    log(`  - è®¾ç½®é”™è¯¯ä¿¡æ¯: ${errorData.message}`, 'info');
                    log('  - è®¾ç½®sheetsä¸ºç©ºæ•°ç»„', 'info');
                    log('  - ç›´æ¥returnï¼Œä¸å¤„ç†æ•°æ®', 'info');
                    log('  - finallyå—ä¼šæ‰§è¡Œï¼Œè®¾ç½®loading=false', 'info');
                    log('âœ… é¡µé¢åº”è¯¥æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ï¼Œè€Œä¸æ˜¯ä¸€ç›´åŠ è½½', 'success');
                } else if (response.ok) {
                    log('â„¹ï¸ å“åº”æˆåŠŸï¼Œä¸æ˜¯404æƒ…å†µ', 'info');
                } else {
                    log(`âš ï¸ å…¶ä»–é”™è¯¯çŠ¶æ€: ${response.status}`, 'warning');
                }
                
            } catch (error) {
                log(`âŒ æµ‹è¯•å¼‚å¸¸: ${error.message}`, 'error');
            }
        }

        async function testSimpleSuccess() {
            log('ğŸ§ª å¼€å§‹æµ‹è¯•æˆåŠŸå“åº”å¤„ç†...', 'info');
            
            // æ¨¡æ‹ŸæˆåŠŸå“åº”çš„å¤„ç†é€»è¾‘
            const mockSuccessResponse = {
                success: true,
                data: {
                    '2026-01': [
                        { mainCompany: 'eyewind', records: { name: 'æµ‹è¯•å‘˜å·¥' } }
                    ]
                }
            };
            
            log('âœ… æˆåŠŸå“åº”å¤„ç†é€»è¾‘:', 'success');
            log('  - æ£€æŸ¥response.ok: true', 'info');
            log('  - æ£€æŸ¥apiResponse.success: true', 'info');
            log('  - æ£€æŸ¥apiResponse.data: å­˜åœ¨', 'info');
            log('  - å¤„ç†æ•°æ®ï¼Œç”ŸæˆtransformedSheets', 'info');
            log('  - è®¾ç½®sheetsçŠ¶æ€', 'info');
            log('  - finallyå—æ‰§è¡Œï¼Œè®¾ç½®loading=false', 'info');
            log('âœ… é¡µé¢åº”è¯¥æ˜¾ç¤ºè€ƒå‹¤æ•°æ®åˆ—è¡¨', 'success');
        }

        async function testSimpleError() {
            log('ğŸ§ª å¼€å§‹æµ‹è¯•é”™è¯¯å“åº”å¤„ç†...', 'info');
            
            // æ¨¡æ‹Ÿä¸åŒçš„é”™è¯¯æƒ…å†µ
            const errorScenarios = [
                { name: 'success=false', success: false, message: 'APIä¸šåŠ¡é€»è¾‘é”™è¯¯' },
                { name: 'æ— dataå­—æ®µ', success: true, data: null },
                { name: 'ç©ºdataå­—æ®µ', success: true, data: {} }
            ];
            
            errorScenarios.forEach(scenario => {
                log(`ğŸ“‹ ${scenario.name}åœºæ™¯:`, 'info');
                log('  - è®¾ç½®å¯¹åº”çš„é”™è¯¯ä¿¡æ¯', 'info');
                log('  - è®¾ç½®sheetsä¸ºç©ºæ•°ç»„', 'info');
                log('  - ç›´æ¥returnï¼Œä¸å¤„ç†æ•°æ®', 'info');
                log('  - finallyå—æ‰§è¡Œï¼Œè®¾ç½®loading=false', 'info');
                log('âœ… é¡µé¢åº”è¯¥æ˜¾ç¤ºå…·ä½“çš„é”™è¯¯ä¿¡æ¯', 'success');
            });
        }

        // é¡µé¢åŠ è½½æ—¶çš„åˆå§‹åŒ–
        window.onload = function() {
            log('ç®€åŒ–404å¤„ç†æµ‹è¯•å·¥å…·åŠ è½½å®Œæˆ', 'success');
            log('', 'info');
            log('ğŸ¯ ç®€åŒ–æ–¹æ¡ˆçš„æ ¸å¿ƒä¼˜åŠ¿:', 'info');
            log('1. é€»è¾‘æ¸…æ™°ï¼šæ¯ç§é”™è¯¯æƒ…å†µéƒ½æœ‰æ˜ç¡®çš„å¤„ç†', 'success');
            log('2. é¿å…å¤æ‚æ€§ï¼šä¸å†æœ‰åµŒå¥—çš„if-elseé€»è¾‘', 'success');
            log('3. ç¡®ä¿finallyæ‰§è¡Œï¼šæ‰€æœ‰è·¯å¾„éƒ½ä¼šåˆ°è¾¾finallyå—', 'success');
            log('4. ç”¨æˆ·ä½“éªŒå¥½ï¼šæ˜ç¡®æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ï¼Œä¸ä¼šä¸€ç›´åŠ è½½', 'success');
            log('', 'info');
            log('ğŸ”§ å…³é”®ä¿®æ”¹ç‚¹:', 'info');
            log('â€¢ 404/success=false/æ— æ•°æ® éƒ½ç›´æ¥return', 'warning');
            log('â€¢ finallyå—ç¡®ä¿loadingçŠ¶æ€æ€»æ˜¯è¢«è®¾ç½®ä¸ºfalse', 'warning');
            log('â€¢ é”™è¯¯ä¿¡æ¯ç›´æ¥æ˜¾ç¤ºç»™ç”¨æˆ·ï¼Œä¸éšè—', 'warning');
            log('', 'info');
            log('ç°åœ¨å¯ä»¥å¼€å§‹æµ‹è¯•ç®€åŒ–æ•ˆæœ...', 'info');
        };
    </script>
</body>
</html>