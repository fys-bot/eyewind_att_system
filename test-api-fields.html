<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APIå­—æ®µæ£€æŸ¥</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: #f8fafc;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
        }
        .result { 
            margin-top: 10px; 
            padding: 15px; 
            background: #f1f5f9; 
            border-radius: 6px; 
            white-space: pre-wrap; 
            font-family: monospace; 
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        .success { border-left: 4px solid #059669; }
        .error { border-left: 4px solid #dc2626; }
        button { 
            padding: 8px 16px; 
            margin: 5px; 
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: white;
            cursor: pointer;
        }
        button:hover {
            background: #f9fafb;
        }
        .field-analysis {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” APIå­—æ®µç»“æ„æ£€æŸ¥</h1>
        
        <p>æ£€æŸ¥è€ƒå‹¤APIè¿”å›çš„å®é™…å­—æ®µç»“æ„ï¼Œç‰¹åˆ«æ˜¯éƒ¨é—¨ç›¸å…³å­—æ®µã€‚</p>
        
        <div class="test-section">
            <h3>æ£€æŸ¥APIè¿”å›çš„å­—æ®µç»“æ„</h3>
            <button onclick="checkApiFields()">æ£€æŸ¥APIå­—æ®µ</button>
            <button onclick="checkSpecificMonth()">æ£€æŸ¥ç‰¹å®šæœˆä»½ (2025-12)</button>
            <button onclick="clearResults()">æ¸…é™¤ç»“æœ</button>
            <div id="apiFieldsResult" class="result" style="display: none;"></div>
        </div>
        
        <div class="field-analysis">
            <h4>ğŸ¯ æ£€æŸ¥ç›®æ ‡</h4>
            <ul>
                <li>ç¡®è®¤APIè¿”å›çš„è®°å½•ä¸­åŒ…å«å“ªäº›å­—æ®µ</li>
                <li>æŸ¥æ‰¾éƒ¨é—¨ç›¸å…³çš„å­—æ®µåç§°ï¼ˆdepartment, dept, dept_nameç­‰ï¼‰</li>
                <li>åˆ†æå­—æ®µå€¼çš„æ ¼å¼å’Œå†…å®¹</li>
                <li>ä¸ºå­—æ®µæ˜ å°„æä¾›å‡†ç¡®çš„ä¿¡æ¯</li>
            </ul>
        </div>
    </div>

    <script>
        function showResult(elementId, content, isError = false) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = `result ${isError ? 'error' : 'success'}`;
            element.textContent = content;
        }
        
        function clearResults() {
            document.getElementById('apiFieldsResult').style.display = 'none';
        }
        
        async function checkApiFields() {
            try {
                showResult('apiFieldsResult', 'ğŸ”„ æ­£åœ¨è¯·æ±‚API...', false);
                
                const response = await fetch('/api/v1/attendance/status/load');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const apiResponse = await response.json();
                
                let analysis = 'ğŸ“Š APIå“åº”åˆ†æ\\n';
                analysis += '='.repeat(50) + '\\n\\n';
                
                analysis += `âœ… å“åº”çŠ¶æ€: ${response.status}\\n`;
                analysis += `ğŸ“ Success: ${apiResponse.success}\\n`;
                analysis += `ğŸ’¬ Message: ${apiResponse.message}\\n\\n`;
                
                if (apiResponse.data) {
                    if (typeof apiResponse.data === 'object' && !Array.isArray(apiResponse.data)) {
                        // æŒ‰æœˆä»½åˆ†ç»„çš„æ•°æ®
                        analysis += 'ğŸ“… æ•°æ®ç»“æ„: æŒ‰æœˆä»½åˆ†ç»„\\n';
                        analysis += `ğŸ“Š æœˆä»½æ•°é‡: ${Object.keys(apiResponse.data).length}\\n`;
                        analysis += `ğŸ“‹ æœˆä»½åˆ—è¡¨: ${Object.keys(apiResponse.data).join(', ')}\\n\\n`;
                        
                        // åˆ†æç¬¬ä¸€ä¸ªæœˆä»½çš„æ•°æ®
                        const firstMonth = Object.keys(apiResponse.data)[0];
                        if (firstMonth && Array.isArray(apiResponse.data[firstMonth])) {
                            const records = apiResponse.data[firstMonth];
                            analysis += `ğŸ” åˆ†ææœˆä»½: ${firstMonth}\\n`;
                            analysis += `ğŸ“ˆ è®°å½•æ•°é‡: ${records.length}\\n\\n`;
                            
                            if (records.length > 0) {
                                const firstRecord = records[0];
                                analysis += 'ğŸ·ï¸ ç¬¬ä¸€æ¡è®°å½•çš„æ‰€æœ‰å­—æ®µ:\\n';
                                analysis += '-'.repeat(30) + '\\n';
                                
                                Object.keys(firstRecord).forEach(key => {
                                    const value = firstRecord[key];
                                    const valueStr = value === null ? 'null' : 
                                                   value === undefined ? 'undefined' : 
                                                   typeof value === 'string' ? `"${value}"` : 
                                                   JSON.stringify(value);
                                    analysis += `${key}: ${valueStr}\\n`;
                                });
                                
                                analysis += '\\nğŸ¢ éƒ¨é—¨ç›¸å…³å­—æ®µæ£€æŸ¥:\\n';
                                analysis += '-'.repeat(30) + '\\n';
                                
                                const departmentFields = ['department', 'dept', 'dept_name', 'department_name', 'deptName', 'departmentName', 'éƒ¨é—¨'];
                                let foundDepartmentFields = [];
                                
                                departmentFields.forEach(field => {
                                    if (field in firstRecord) {
                                        foundDepartmentFields.push(field);
                                        analysis += `âœ… ${field}: ${JSON.stringify(firstRecord[field])}\\n`;
                                    } else {
                                        analysis += `âŒ ${field}: ä¸å­˜åœ¨\\n`;
                                    }
                                });
                                
                                if (foundDepartmentFields.length === 0) {
                                    analysis += '\\nâš ï¸ è­¦å‘Š: æ²¡æœ‰æ‰¾åˆ°ä»»ä½•éƒ¨é—¨ç›¸å…³å­—æ®µï¼\\n';
                                    analysis += 'ğŸ’¡ å»ºè®®: æ£€æŸ¥APIæ•°æ®æºæˆ–è€ƒè™‘ä»å…¶ä»–å­—æ®µè·å–éƒ¨é—¨ä¿¡æ¯\\n';
                                } else {
                                    analysis += `\\nâœ… æ‰¾åˆ° ${foundDepartmentFields.length} ä¸ªéƒ¨é—¨å­—æ®µ: ${foundDepartmentFields.join(', ')}\\n`;
                                }
                                
                                // æ£€æŸ¥æ›´å¤šè®°å½•ä»¥ç¡®è®¤å­—æ®µä¸€è‡´æ€§
                                if (records.length > 1) {
                                    analysis += '\\nğŸ”„ æ£€æŸ¥å­—æ®µä¸€è‡´æ€§ (å‰5æ¡è®°å½•):\\n';
                                    analysis += '-'.repeat(30) + '\\n';
                                    
                                    const checkRecords = records.slice(0, 5);
                                    foundDepartmentFields.forEach(field => {
                                        analysis += `${field}å­—æ®µå€¼:\\n`;
                                        checkRecords.forEach((record, index) => {
                                            const value = record[field];
                                            const valueStr = value === null ? 'null' : 
                                                           value === undefined ? 'undefined' : 
                                                           typeof value === 'string' ? `"${value}"` : 
                                                           JSON.stringify(value);
                                            analysis += `  è®°å½•${index + 1}: ${valueStr}\\n`;
                                        });
                                        analysis += '\\n';
                                    });
                                }
                            }
                        }
                    } else if (Array.isArray(apiResponse.data)) {
                        // ç›´æ¥çš„æ•°ç»„æ•°æ®
                        analysis += 'ğŸ“… æ•°æ®ç»“æ„: ç›´æ¥æ•°ç»„\\n';
                        analysis += `ğŸ“ˆ è®°å½•æ•°é‡: ${apiResponse.data.length}\\n\\n`;
                        
                        if (apiResponse.data.length > 0) {
                            const firstRecord = apiResponse.data[0];
                            analysis += 'ğŸ·ï¸ ç¬¬ä¸€æ¡è®°å½•çš„æ‰€æœ‰å­—æ®µ:\\n';
                            analysis += '-'.repeat(30) + '\\n';
                            
                            Object.keys(firstRecord).forEach(key => {
                                const value = firstRecord[key];
                                const valueStr = value === null ? 'null' : 
                                               value === undefined ? 'undefined' : 
                                               typeof value === 'string' ? `"${value}"` : 
                                               JSON.stringify(value);
                                analysis += `${key}: ${valueStr}\\n`;
                            });
                        }
                    }
                } else {
                    analysis += 'âŒ æ²¡æœ‰æ•°æ®è¿”å›\\n';
                }
                
                showResult('apiFieldsResult', analysis, false);
                
            } catch (error) {
                showResult('apiFieldsResult', `âŒ è¯·æ±‚å¤±è´¥: ${error.message}`, true);
            }
        }
        
        async function checkSpecificMonth() {
            try {
                showResult('apiFieldsResult', 'ğŸ”„ æ­£åœ¨è¯·æ±‚ç‰¹å®šæœˆä»½æ•°æ®...', false);
                
                const response = await fetch('/api/v1/attendance/status/load/2025-12');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const apiResponse = await response.json();
                
                let analysis = 'ğŸ“Š ç‰¹å®šæœˆä»½APIå“åº”åˆ†æ (2025-12)\\n';
                analysis += '='.repeat(50) + '\\n\\n';
                
                analysis += `âœ… å“åº”çŠ¶æ€: ${response.status}\\n`;
                analysis += `ğŸ“ Success: ${apiResponse.success}\\n`;
                analysis += `ğŸ’¬ Message: ${apiResponse.message}\\n\\n`;
                
                if (apiResponse.data && Array.isArray(apiResponse.data)) {
                    analysis += `ğŸ“ˆ è®°å½•æ•°é‡: ${apiResponse.data.length}\\n\\n`;
                    
                    if (apiResponse.data.length > 0) {
                        const firstRecord = apiResponse.data[0];
                        analysis += 'ğŸ·ï¸ ç¬¬ä¸€æ¡è®°å½•çš„æ‰€æœ‰å­—æ®µ:\\n';
                        analysis += '-'.repeat(30) + '\\n';
                        
                        Object.keys(firstRecord).forEach(key => {
                            const value = firstRecord[key];
                            const valueStr = value === null ? 'null' : 
                                           value === undefined ? 'undefined' : 
                                           typeof value === 'string' ? `"${value}"` : 
                                           JSON.stringify(value);
                            analysis += `${key}: ${valueStr}\\n`;
                        });
                        
                        analysis += '\\nğŸ¢ éƒ¨é—¨ç›¸å…³å­—æ®µæ£€æŸ¥:\\n';
                        analysis += '-'.repeat(30) + '\\n';
                        
                        const departmentFields = ['department', 'dept', 'dept_name', 'department_name', 'deptName', 'departmentName', 'éƒ¨é—¨'];
                        let foundDepartmentFields = [];
                        
                        departmentFields.forEach(field => {
                            if (field in firstRecord) {
                                foundDepartmentFields.push(field);
                                analysis += `âœ… ${field}: ${JSON.stringify(firstRecord[field])}\\n`;
                            } else {
                                analysis += `âŒ ${field}: ä¸å­˜åœ¨\\n`;
                            }
                        });
                        
                        if (foundDepartmentFields.length === 0) {
                            analysis += '\\nâš ï¸ è­¦å‘Š: æ²¡æœ‰æ‰¾åˆ°ä»»ä½•éƒ¨é—¨ç›¸å…³å­—æ®µï¼\\n';
                            analysis += 'ğŸ’¡ å¯èƒ½çš„è§£å†³æ–¹æ¡ˆ:\\n';
                            analysis += '  1. æ£€æŸ¥æ•°æ®æºè¡¨æ˜¯å¦åŒ…å«éƒ¨é—¨å­—æ®µ\\n';
                            analysis += '  2. è€ƒè™‘ä»å‘˜å·¥APIè·å–éƒ¨é—¨ä¿¡æ¯\\n';
                            analysis += '  3. æ£€æŸ¥å­—æ®µåç§°æ˜¯å¦ä½¿ç”¨äº†å…¶ä»–å‘½åæ–¹å¼\\n';
                        } else {
                            analysis += `\\nâœ… æ‰¾åˆ° ${foundDepartmentFields.length} ä¸ªéƒ¨é—¨å­—æ®µ: ${foundDepartmentFields.join(', ')}\\n`;
                        }
                    }
                } else {
                    analysis += 'âŒ æ²¡æœ‰æ•°æ®è¿”å›æˆ–æ•°æ®æ ¼å¼ä¸æ­£ç¡®\\n';
                }
                
                showResult('apiFieldsResult', analysis, false);
                
            } catch (error) {
                showResult('apiFieldsResult', `âŒ è¯·æ±‚å¤±è´¥: ${error.message}`, true);
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºè¯´æ˜
        window.onload = function() {
            console.log('APIå­—æ®µæ£€æŸ¥å·¥å…·å·²åŠ è½½');
        };
    </script>
</body>
</html>