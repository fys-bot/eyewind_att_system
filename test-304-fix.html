<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>304çŠ¶æ€ç ä¿®å¤æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        button { padding: 8px 16px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .result { margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 3px; white-space: pre-wrap; font-family: monospace; }
        .success { border-left: 4px solid #28a745; }
        .error { border-left: 4px solid #dc3545; }
        .warning { border-left: 4px solid #ffc107; }
    </style>
</head>
<body>
    <h1>304çŠ¶æ€ç ä¿®å¤æµ‹è¯•</h1>
    
    <div class="test-section">
        <h3>æµ‹è¯•APIå“åº”çŠ¶æ€ç å¤„ç†</h3>
        <button onclick="testAPI()">æµ‹è¯•APIè°ƒç”¨</button>
        <button onclick="testMultipleCalls()">æµ‹è¯•å¤šæ¬¡è°ƒç”¨ï¼ˆæ£€æŸ¥ç¼“å­˜ï¼‰</button>
        <div id="testResult" class="result" style="display: none;"></div>
    </div>

    <script>
        function showResult(data, type = 'success') {
            const element = document.getElementById('testResult');
            element.style.display = 'block';
            element.className = `result ${type}`;
            element.textContent = JSON.stringify(data, null, 2);
        }
        
        async function testAPI() {
            try {
                console.log('ğŸ” æµ‹è¯•APIè°ƒç”¨...');
                
                const response = await fetch('/api/v1/attendance/status/load');
                
                console.log('ğŸ“Š å“åº”çŠ¶æ€:', response.status);
                console.log('ğŸ“Š å“åº”å¤´:', Object.fromEntries(response.headers.entries()));
                
                const result = {
                    status: response.status,
                    statusText: response.statusText,
                    ok: response.ok,
                    headers: Object.fromEntries(response.headers.entries()),
                    timestamp: new Date().toISOString()
                };
                
                if (response.status === 304) {
                    result.message = 'æ”¶åˆ°304å“åº” - å†…å®¹æœªä¿®æ”¹';
                    showResult(result, 'warning');
                } else if (response.ok) {
                    const data = await response.json();
                    result.data = {
                        success: data.success,
                        message: data.message,
                        dataKeys: data.data ? Object.keys(data.data) : null
                    };
                    showResult(result, 'success');
                } else {
                    result.message = 'è¯·æ±‚å¤±è´¥';
                    showResult(result, 'error');
                }
                
            } catch (error) {
                showResult({ error: error.message, timestamp: new Date().toISOString() }, 'error');
            }
        }
        
        async function testMultipleCalls() {
            try {
                console.log('ğŸ” æµ‹è¯•å¤šæ¬¡APIè°ƒç”¨...');
                
                const results = [];
                
                for (let i = 0; i < 3; i++) {
                    const response = await fetch('/api/v1/attendance/status/load');
                    results.push({
                        call: i + 1,
                        status: response.status,
                        statusText: response.statusText,
                        ok: response.ok,
                        timestamp: new Date().toISOString()
                    });
                    
                    // çŸ­æš‚å»¶è¿Ÿ
                    await new Promise(resolve => setTimeout(resolve, 100));
                }
                
                showResult({ 
                    message: 'å¤šæ¬¡è°ƒç”¨ç»“æœ',
                    results: results 
                }, 'success');
                
            } catch (error) {
                showResult({ error: error.message, timestamp: new Date().toISOString() }, 'error');
            }
        }
    </script>
</body>
</html>