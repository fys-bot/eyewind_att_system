<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éƒ¨é—¨æ˜¾ç¤ºä¿®å¤éªŒè¯</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: #f8fafc;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .problem-found {
            background: #fef2f2;
            border: 1px solid #f87171;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .fix-applied {
            background: #dcfce7;
            border: 1px solid #16a34a;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
        }
        .result { 
            margin-top: 10px; 
            padding: 15px; 
            background: #f1f5f9; 
            border-radius: 6px; 
            white-space: pre-wrap; 
            font-family: monospace; 
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        .success { border-left: 4px solid #059669; }
        .error { border-left: 4px solid #dc2626; }
        .info { border-left: 4px solid #0284c7; }
        button { 
            padding: 8px 16px; 
            margin: 5px; 
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: white;
            cursor: pointer;
        }
        button:hover {
            background: #f9fafb;
        }
        .code-block {
            background: #1e293b;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
            margin: 10px 0;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ éƒ¨é—¨æ˜¾ç¤ºä¿®å¤éªŒè¯</h1>
        
        <div class="problem-found">
            <h3>âŒ å‘ç°çš„é—®é¢˜</h3>
            <p><strong>ç°è±¡ï¼š</strong>ç¼“å­˜æ•°æ®ä¸­æ˜æ˜æœ‰éƒ¨é—¨ä¿¡æ¯ï¼ˆå¦‚"æŠ€æœ¯éƒ¨"ï¼‰ï¼Œä½†é¡µé¢æ˜¾ç¤ºä¸­éƒ¨é—¨åˆ—ä»ç„¶ä¸ºç©º</p>
            
            <h4>ğŸ” æ ¹æœ¬åŸå› ï¼š</h4>
            <p><strong>æ˜¾ç¤ºé€»è¾‘é—®é¢˜ï¼š</strong>DetailViewç»„ä»¶ä¸­çš„éƒ¨é—¨æ˜¾ç¤ºé€»è¾‘æœ‰ç¼ºé™·</p>
            <ol>
                <li>AttendancePageæ­£ç¡®æ˜ å°„äº†éƒ¨é—¨ä¿¡æ¯åˆ° record.department</li>
                <li>ä½†DetailViewåªæ˜¾ç¤º dingTalkUser?.department</li>
                <li>æ²¡æœ‰ä½¿ç”¨ record.department ä½œä¸ºfallback</li>
                <li>å¯¼è‡´å³ä½¿æ•°æ®æ­£ç¡®ï¼Œæ˜¾ç¤ºä»ç„¶ä¸ºç©º</li>
            </ol>
        </div>
        
        <div class="fix-applied">
            <h3>âœ… ä¿®å¤æ–¹æ¡ˆ</h3>
            <p><strong>ä¿®å¤æ˜¾ç¤ºé€»è¾‘ï¼š</strong>åœ¨æ‰€æœ‰æ˜¾ç¤ºéƒ¨é—¨ä¿¡æ¯çš„åœ°æ–¹ä½¿ç”¨æ­£ç¡®çš„fallbacké€»è¾‘</p>
            
            <h4>ğŸ”§ ä¿®å¤å†…å®¹ï¼š</h4>
            <ol>
                <li><strong>DetailView.tsx</strong>: ä¿®æ”¹éƒ¨é—¨æ˜¾ç¤ºé€»è¾‘ä¸º `dingTalkUser?.department || record.department`</li>
                <li><strong>Modals.tsx</strong>: å·²ç»ä½¿ç”¨äº†æ­£ç¡®çš„fallbacké€»è¾‘ï¼ˆæ— éœ€ä¿®æ”¹ï¼‰</li>
                <li><strong>CreateWizard.tsx</strong>: åˆ›å»ºæ–°è®°å½•æ—¶çš„é€»è¾‘åˆç†ï¼ˆæ— éœ€ä¿®æ”¹ï¼‰</li>
            </ol>
        </div>
        
        <div class="test-section">
            <h3>ğŸ§ª æ˜¾ç¤ºé€»è¾‘éªŒè¯</h3>
            <button onclick="testDisplayLogic()">æµ‹è¯•æ˜¾ç¤ºé€»è¾‘</button>
            <button onclick="testFallbackScenarios()">æµ‹è¯•Fallbackåœºæ™¯</button>
            <button onclick="clearResults()">æ¸…é™¤ç»“æœ</button>
        </div>
        
        <div class="test-section">
            <h3>ğŸ“‹ ä¿®å¤å‰åå¯¹æ¯”</h3>
            
            <h4>ä¿®å¤å‰çš„é—®é¢˜ä»£ç ï¼š</h4>
            <div class="code-block">
// âŒ é—®é¢˜ä»£ç ï¼šåªæ˜¾ç¤ºé’‰é’‰ç”¨æˆ·æ•°æ®ä¸­çš„éƒ¨é—¨
{hasResigned ? 
    &lt;span className="px-2 py-0.5 bg-slate-100 dark:bg-slate-700 rounded text-xs"&gt;å·²ç¦»èŒ&lt;/span&gt; : 
    dingTalkUser?.department
}
            </div>
            
            <h4>ä¿®å¤åçš„ä»£ç ï¼š</h4>
            <div class="code-block">
// âœ… ä¿®å¤ä»£ç ï¼šä½¿ç”¨fallbacké€»è¾‘
{hasResigned ? 
    &lt;span className="px-2 py-0.5 bg-slate-100 dark:bg-slate-700 rounded text-xs"&gt;å·²ç¦»èŒ&lt;/span&gt; : 
    (dingTalkUser?.department || record.department)
}
            </div>
        </div>
        
        <div id="results"></div>
    </div>

    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = message;
            results.appendChild(div);
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        function testDisplayLogic() {
            clearResults();
            log('ğŸ§ª å¼€å§‹æµ‹è¯•éƒ¨é—¨æ˜¾ç¤ºé€»è¾‘...', 'info');
            
            // æ¨¡æ‹Ÿä¸åŒçš„æ•°æ®åœºæ™¯
            const testScenarios = [
                {
                    name: 'é’‰é’‰ç”¨æˆ·æœ‰éƒ¨é—¨ï¼Œè€ƒå‹¤è®°å½•ä¹Ÿæœ‰éƒ¨é—¨',
                    dingTalkUser: { department: 'é’‰é’‰æŠ€æœ¯éƒ¨' },
                    record: { department: 'è€ƒå‹¤æŠ€æœ¯éƒ¨' },
                    expected: 'é’‰é’‰æŠ€æœ¯éƒ¨', // ä¼˜å…ˆä½¿ç”¨é’‰é’‰æ•°æ®
                    hasResigned: false
                },
                {
                    name: 'é’‰é’‰ç”¨æˆ·æ— éƒ¨é—¨ï¼Œè€ƒå‹¤è®°å½•æœ‰éƒ¨é—¨',
                    dingTalkUser: null,
                    record: { department: 'è€ƒå‹¤æŠ€æœ¯éƒ¨' },
                    expected: 'è€ƒå‹¤æŠ€æœ¯éƒ¨', // fallbackåˆ°è€ƒå‹¤è®°å½•
                    hasResigned: false
                },
                {
                    name: 'é’‰é’‰ç”¨æˆ·æœ‰éƒ¨é—¨ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œè€ƒå‹¤è®°å½•æœ‰éƒ¨é—¨',
                    dingTalkUser: { department: '' },
                    record: { department: 'è€ƒå‹¤æŠ€æœ¯éƒ¨' },
                    expected: 'è€ƒå‹¤æŠ€æœ¯éƒ¨', // ç©ºå­—ç¬¦ä¸²fallbackåˆ°è€ƒå‹¤è®°å½•
                    hasResigned: false
                },
                {
                    name: 'é’‰é’‰ç”¨æˆ·å’Œè€ƒå‹¤è®°å½•éƒ½æ— éƒ¨é—¨',
                    dingTalkUser: null,
                    record: { department: '' },
                    expected: '', // éƒ½æ²¡æœ‰å°±æ˜¾ç¤ºç©º
                    hasResigned: false
                },
                {
                    name: 'å‘˜å·¥å·²ç¦»èŒï¼ˆä¸æ˜¾ç¤ºéƒ¨é—¨ï¼‰',
                    dingTalkUser: { department: 'æŠ€æœ¯éƒ¨' },
                    record: { department: 'è€ƒå‹¤æŠ€æœ¯éƒ¨' },
                    expected: 'å·²ç¦»èŒ', // ç¦»èŒçŠ¶æ€
                    hasResigned: true
                }
            ];
            
            testScenarios.forEach((scenario, index) => {
                log(`<br>ğŸ“‹ åœºæ™¯ ${index + 1}: ${scenario.name}`, 'info');
                
                // æ¨¡æ‹Ÿæ˜¾ç¤ºé€»è¾‘
                let displayValue;
                if (scenario.hasResigned) {
                    displayValue = 'å·²ç¦»èŒ';
                } else {
                    displayValue = (scenario.dingTalkUser?.department || scenario.record.department) || '';
                }
                
                log(`   é’‰é’‰ç”¨æˆ·éƒ¨é—¨: ${scenario.dingTalkUser?.department || 'null'}`, 'info');
                log(`   è€ƒå‹¤è®°å½•éƒ¨é—¨: ${scenario.record.department || 'null'}`, 'info');
                log(`   æ˜¯å¦ç¦»èŒ: ${scenario.hasResigned}`, 'info');
                log(`   æ˜¾ç¤ºç»“æœ: "${displayValue}"`, 'info');
                log(`   æœŸæœ›ç»“æœ: "${scenario.expected}"`, 'info');
                
                if (displayValue === scenario.expected) {
                    log(`   âœ… æ˜¾ç¤ºé€»è¾‘æ­£ç¡®`, 'success');
                } else {
                    log(`   âŒ æ˜¾ç¤ºé€»è¾‘é”™è¯¯`, 'error');
                }
            });
            
            log(`<br>ğŸ‰ éƒ¨é—¨æ˜¾ç¤ºé€»è¾‘æµ‹è¯•å®Œæˆ`, 'success');
        }

        function testFallbackScenarios() {
            clearResults();
            log('ğŸ”„ å¼€å§‹æµ‹è¯•Fallbackåœºæ™¯...', 'info');
            
            log('åœºæ™¯1: ç†æƒ³æƒ…å†µ - é’‰é’‰æ•°æ®å®Œæ•´', 'info');
            log('  â†’ é’‰é’‰ç”¨æˆ·éƒ¨é—¨: "æŠ€æœ¯éƒ¨"', 'info');
            log('  â†’ è€ƒå‹¤è®°å½•éƒ¨é—¨: "äº§å“éƒ¨"', 'info');
            log('  â†’ æ˜¾ç¤ºç»“æœ: "æŠ€æœ¯éƒ¨" (ä¼˜å…ˆä½¿ç”¨é’‰é’‰æ•°æ®)', 'success');
            
            log('<br>åœºæ™¯2: é’‰é’‰æ•°æ®ç¼ºå¤± - ä½¿ç”¨è€ƒå‹¤è®°å½•', 'info');
            log('  â†’ é’‰é’‰ç”¨æˆ·éƒ¨é—¨: null', 'info');
            log('  â†’ è€ƒå‹¤è®°å½•éƒ¨é—¨: "æŠ€æœ¯éƒ¨"', 'info');
            log('  â†’ æ˜¾ç¤ºç»“æœ: "æŠ€æœ¯éƒ¨" (fallbackåˆ°è€ƒå‹¤è®°å½•)', 'success');
            
            log('<br>åœºæ™¯3: é’‰é’‰æ•°æ®ä¸ºç©ºå­—ç¬¦ä¸² - ä½¿ç”¨è€ƒå‹¤è®°å½•', 'info');
            log('  â†’ é’‰é’‰ç”¨æˆ·éƒ¨é—¨: ""', 'info');
            log('  â†’ è€ƒå‹¤è®°å½•éƒ¨é—¨: "æŠ€æœ¯éƒ¨"', 'info');
            log('  â†’ æ˜¾ç¤ºç»“æœ: "æŠ€æœ¯éƒ¨" (ç©ºå­—ç¬¦ä¸²fallback)', 'success');
            
            log('<br>åœºæ™¯4: å‘˜å·¥ç¦»èŒ - æ˜¾ç¤ºç¦»èŒçŠ¶æ€', 'info');
            log('  â†’ å‘˜å·¥çŠ¶æ€: å·²ç¦»èŒ', 'info');
            log('  â†’ æ˜¾ç¤ºç»“æœ: "å·²ç¦»èŒ" (ä¸æ˜¾ç¤ºéƒ¨é—¨ä¿¡æ¯)', 'info');
            
            log('<br>âœ… ä¿®å¤åçš„é¢„æœŸæ•ˆæœ:', 'success');
            log('â€¢ ä¼˜å…ˆæ˜¾ç¤ºé’‰é’‰ç”¨æˆ·æ•°æ®ä¸­çš„éƒ¨é—¨ä¿¡æ¯', 'success');
            log('â€¢ é’‰é’‰æ•°æ®ç¼ºå¤±æ—¶è‡ªåŠ¨ä½¿ç”¨è€ƒå‹¤è®°å½•ä¸­çš„éƒ¨é—¨ä¿¡æ¯', 'success');
            log('â€¢ å‘˜å·¥ç¦»èŒæ—¶æ˜¾ç¤ºç¦»èŒçŠ¶æ€è€Œä¸æ˜¯éƒ¨é—¨ä¿¡æ¯', 'success');
            log('â€¢ ç¡®ä¿éƒ¨é—¨ä¿¡æ¯ä¸å†æ˜¾ç¤ºä¸ºç©ºï¼ˆé™¤éçœŸçš„æ²¡æœ‰æ•°æ®ï¼‰', 'success');
        }

        // é¡µé¢åŠ è½½æ—¶çš„åˆå§‹åŒ–
        window.onload = function() {
            log('éƒ¨é—¨æ˜¾ç¤ºä¿®å¤éªŒè¯å·¥å…·åŠ è½½å®Œæˆ', 'success');
            log('', 'info');
            log('ğŸ¯ ä¿®å¤çš„æ ¸å¿ƒé—®é¢˜:', 'info');
            log('â€¢ ç¼“å­˜æ•°æ®æœ‰éƒ¨é—¨ä¿¡æ¯ä½†é¡µé¢æ˜¾ç¤ºä¸ºç©º', 'warning');
            log('â€¢ DetailViewç»„ä»¶æ˜¾ç¤ºé€»è¾‘ä¸å®Œæ•´', 'warning');
            log('â€¢ æ²¡æœ‰ä½¿ç”¨è€ƒå‹¤è®°å½•ä¸­çš„éƒ¨é—¨ä¿¡æ¯ä½œä¸ºfallback', 'warning');
            log('', 'info');
            log('âœ… ä¿®å¤æ–¹æ¡ˆ:', 'info');
            log('â€¢ ä¿®æ”¹DetailViewä¸­çš„éƒ¨é—¨æ˜¾ç¤ºé€»è¾‘', 'success');
            log('â€¢ ä½¿ç”¨ dingTalkUser?.department || record.department', 'success');
            log('â€¢ ç¡®ä¿æ‰€æœ‰æ˜¾ç¤ºéƒ¨é—¨çš„åœ°æ–¹éƒ½æœ‰æ­£ç¡®çš„fallback', 'success');
            log('', 'info');
            log('ğŸ” ä¿®å¤åçš„é¢„æœŸæ•ˆæœ:', 'info');
            log('â€¢ éƒ¨é—¨ä¿¡æ¯æ­£ç¡®æ˜¾ç¤º', 'success');
            log('â€¢ é’‰é’‰æ•°æ®ä¼˜å…ˆï¼Œè€ƒå‹¤è®°å½•fallback', 'success');
            log('â€¢ ç¦»èŒå‘˜å·¥æ˜¾ç¤ºç¦»èŒçŠ¶æ€', 'success');
            log('', 'info');
            log('ç°åœ¨å¯ä»¥å¼€å§‹éªŒè¯ä¿®å¤æ•ˆæœ...', 'info');
        };
    </script>
</body>
</html>