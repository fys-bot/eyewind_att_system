<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éƒ¨é—¨å­—æ®µæ˜ å°„æµ‹è¯•</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: #f8fafc;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
        }
        .success { background: #dcfce7; color: #059669; }
        .error { background: #fef2f2; color: #dc2626; }
        .info { background: #f1f5f9; color: #0284c7; }
        button { 
            padding: 8px 16px; 
            margin: 5px; 
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: white;
            cursor: pointer;
        }
        button:hover {
            background: #f9fafb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¢ éƒ¨é—¨å­—æ®µæ˜ å°„æµ‹è¯•</h1>
        
        <p>æµ‹è¯•AttendancePage.tsxä¸­çš„éƒ¨é—¨å­—æ®µæ˜ å°„é€»è¾‘æ˜¯å¦æ­£ç¡®å¤„ç†å„ç§å­—æ®µåç§°å˜ä½“ã€‚</p>
        
        <button onclick="runDepartmentMappingTest()">è¿è¡Œéƒ¨é—¨å­—æ®µæ˜ å°„æµ‹è¯•</button>
        <button onclick="clearResults()">æ¸…é™¤ç»“æœ</button>
        
        <div id="results"></div>
    </div>

    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = message;
            results.appendChild(div);
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        // æ¨¡æ‹ŸAttendancePage.tsxä¸­çš„éƒ¨é—¨å­—æ®µæ˜ å°„é€»è¾‘
        function mapDepartmentField(record) {
            return record.department || 
                   record.dept || 
                   record.dept_name || 
                   record.department_name || 
                   record.deptName || 
                   record.departmentName || 
                   record.éƒ¨é—¨ || '';
        }

        function runDepartmentMappingTest() {
            clearResults();
            log('ğŸš€ å¼€å§‹éƒ¨é—¨å­—æ®µæ˜ å°„æµ‹è¯•...', 'info');
            
            const testCases = [
                {
                    name: 'æ ‡å‡†departmentå­—æ®µ',
                    record: { userid: '001', username: 'å¼ ä¸‰', department: 'æŠ€æœ¯éƒ¨' },
                    expected: 'æŠ€æœ¯éƒ¨'
                },
                {
                    name: 'deptå­—æ®µ',
                    record: { userid: '002', username: 'æå››', dept: 'äº§å“éƒ¨' },
                    expected: 'äº§å“éƒ¨'
                },
                {
                    name: 'dept_nameå­—æ®µ',
                    record: { userid: '003', username: 'ç‹äº”', dept_name: 'è¿è¥éƒ¨' },
                    expected: 'è¿è¥éƒ¨'
                },
                {
                    name: 'department_nameå­—æ®µ',
                    record: { userid: '004', username: 'èµµå…­', department_name: 'å¸‚åœºéƒ¨' },
                    expected: 'å¸‚åœºéƒ¨'
                },
                {
                    name: 'deptNameå­—æ®µï¼ˆé©¼å³°å‘½åï¼‰',
                    record: { userid: '005', username: 'é’±ä¸ƒ', deptName: 'è´¢åŠ¡éƒ¨' },
                    expected: 'è´¢åŠ¡éƒ¨'
                },
                {
                    name: 'departmentNameå­—æ®µï¼ˆå®Œæ•´é©¼å³°å‘½åï¼‰',
                    record: { userid: '006', username: 'å­™å…«', departmentName: 'äººäº‹éƒ¨' },
                    expected: 'äººäº‹éƒ¨'
                },
                {
                    name: 'ä¸­æ–‡éƒ¨é—¨å­—æ®µ',
                    record: { userid: '007', username: 'å‘¨ä¹', éƒ¨é—¨: 'æ³•åŠ¡éƒ¨' },
                    expected: 'æ³•åŠ¡éƒ¨'
                },
                {
                    name: 'å¤šå­—æ®µä¼˜å…ˆçº§æµ‹è¯•ï¼ˆdepartmentä¼˜å…ˆï¼‰',
                    record: { 
                        userid: '008', 
                        username: 'å´å',
                        department: 'æŠ€æœ¯éƒ¨',
                        dept: 'äº§å“éƒ¨',
                        dept_name: 'è¿è¥éƒ¨'
                    },
                    expected: 'æŠ€æœ¯éƒ¨'
                },
                {
                    name: 'å¤šå­—æ®µä¼˜å…ˆçº§æµ‹è¯•ï¼ˆdeptæ¬¡ä¼˜å…ˆï¼‰',
                    record: { 
                        userid: '009', 
                        username: 'éƒ‘åä¸€',
                        dept: 'äº§å“éƒ¨',
                        dept_name: 'è¿è¥éƒ¨',
                        deptName: 'è´¢åŠ¡éƒ¨'
                    },
                    expected: 'äº§å“éƒ¨'
                },
                {
                    name: 'æ— éƒ¨é—¨å­—æ®µ',
                    record: { userid: '010', username: 'ç‹åäºŒ' },
                    expected: ''
                },
                {
                    name: 'ç©ºå­—ç¬¦ä¸²éƒ¨é—¨å­—æ®µ',
                    record: { userid: '011', username: 'æåä¸‰', department: '' },
                    expected: ''
                },
                {
                    name: 'nulléƒ¨é—¨å­—æ®µ',
                    record: { userid: '012', username: 'å¼ åå››', department: null },
                    expected: ''
                },
                {
                    name: 'undefinedéƒ¨é—¨å­—æ®µ',
                    record: { userid: '013', username: 'èµµåäº”', department: undefined },
                    expected: ''
                }
            ];
            
            let passedTests = 0;
            let totalTests = testCases.length;
            
            testCases.forEach((testCase, index) => {
                log(`<br>ğŸ“‹ æµ‹è¯• ${index + 1}: ${testCase.name}`, 'info');
                
                const result = mapDepartmentField(testCase.record);
                
                log(`   è¾“å…¥: ${JSON.stringify(testCase.record)}`, 'info');
                log(`   æœŸæœ›: "${testCase.expected}"`, 'info');
                log(`   å®é™…: "${result}"`, 'info');
                
                if (result === testCase.expected) {
                    log(`   âœ… æµ‹è¯•é€šè¿‡`, 'success');
                    passedTests++;
                } else {
                    log(`   âŒ æµ‹è¯•å¤±è´¥`, 'error');
                }
            });
            
            log(`<br>ğŸ¯ æµ‹è¯•æ€»ç»“:`, 'info');
            log(`   æ€»æµ‹è¯•æ•°: ${totalTests}`, 'info');
            log(`   é€šè¿‡æ•°: ${passedTests}`, passedTests === totalTests ? 'success' : 'error');
            log(`   å¤±è´¥æ•°: ${totalTests - passedTests}`, totalTests - passedTests === 0 ? 'success' : 'error');
            log(`   é€šè¿‡ç‡: ${((passedTests / totalTests) * 100).toFixed(1)}%`, passedTests === totalTests ? 'success' : 'error');
            
            if (passedTests === totalTests) {
                log(`<br>ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼éƒ¨é—¨å­—æ®µæ˜ å°„é€»è¾‘å·¥ä½œæ­£å¸¸ã€‚`, 'success');
            } else {
                log(`<br>âš ï¸ æœ‰æµ‹è¯•å¤±è´¥ï¼Œéœ€è¦æ£€æŸ¥æ˜ å°„é€»è¾‘ã€‚`, 'error');
            }
            
            log(`<br>ğŸ“ å­—æ®µæ˜ å°„ä¼˜å…ˆçº§:`, 'info');
            log(`   1. department (æ ‡å‡†å­—æ®µ)`, 'info');
            log(`   2. dept (ç®€å†™)`, 'info');
            log(`   3. dept_name (ä¸‹åˆ’çº¿å‘½å)`, 'info');
            log(`   4. department_name (å®Œæ•´ä¸‹åˆ’çº¿å‘½å)`, 'info');
            log(`   5. deptName (é©¼å³°å‘½å)`, 'info');
            log(`   6. departmentName (å®Œæ•´é©¼å³°å‘½å)`, 'info');
            log(`   7. éƒ¨é—¨ (ä¸­æ–‡å­—æ®µ)`, 'info');
        }

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºè¯´æ˜
        window.onload = function() {
            log('éƒ¨é—¨å­—æ®µæ˜ å°„æµ‹è¯•å·¥å…·å·²åŠ è½½', 'success');
            log('', 'info');
            log('ğŸ¯ æµ‹è¯•ç›®æ ‡:', 'info');
            log('â€¢ éªŒè¯éƒ¨é—¨å­—æ®µæ˜ å°„é€»è¾‘çš„æ­£ç¡®æ€§', 'info');
            log('â€¢ ç¡®ä¿æ”¯æŒå¤šç§å­—æ®µåç§°å˜ä½“', 'info');
            log('â€¢ éªŒè¯å­—æ®µä¼˜å…ˆçº§é¡ºåº', 'info');
            log('â€¢ æµ‹è¯•è¾¹ç•Œæƒ…å†µå¤„ç†', 'info');
            log('', 'info');
            log('ç‚¹å‡»"è¿è¡Œéƒ¨é—¨å­—æ®µæ˜ å°„æµ‹è¯•"å¼€å§‹æµ‹è¯•...', 'info');
        };
    </script>
</body>
</html>