<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è€ƒå‹¤Loadæ¥å£æµ‹è¯•</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: #f8fafc;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .demo-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
        }
        .log { 
            background: #f1f5f9; 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 4px; 
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        .success { color: #059669; }
        .info { color: #0284c7; }
        .warning { color: #d97706; }
        .error { color: #dc2626; }
        button { 
            padding: 8px 16px; 
            margin: 5px; 
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: white;
            cursor: pointer;
        }
        button:hover {
            background: #f9fafb;
        }
        .api-test {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 15px;
            margin: 10px 0;
        }
        .url-display {
            background: #1e293b;
            color: #e2e8f0;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            margin: 10px 0;
        }
        .response-display {
            background: #f1f5f9;
            border: 1px solid #cbd5e1;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>è€ƒå‹¤Loadæ¥å£è°ƒç”¨æµ‹è¯•</h1>
        <p>æµ‹è¯•è€ƒå‹¤ç¡®è®¤é¡µé¢çš„loadæ¥å£è°ƒç”¨ï¼ŒéªŒè¯æœˆä»½å‚æ•°æ˜¯å¦æ­£ç¡®ä¼ é€’ã€‚</p>
        
        <div class="demo-section">
            <h3>é—®é¢˜åˆ†æ</h3>
            <ul>
                <li>âŒ è¿›å…¥è€ƒå‹¤ç¡®è®¤é¡µé¢æ—¶æ²¡æœ‰è°ƒç”¨loadæ¥å£</li>
                <li>ğŸ”§ éœ€è¦åœ¨è·¯ç”±å¤„åŠ ä¸Šæœˆä»½å‚æ•°</li>
                <li>âœ… æœåŠ¡å™¨ç«¯å·²æ”¯æŒ <code>/api/v1/attendance/status/load/:pathSegment?</code></li>
                <li>âœ… å‰ç«¯å·²ä¿®æ”¹ä¸ºåŒ…å«æœˆä»½å‚æ•°çš„URL</li>
            </ul>
        </div>

        <div class="demo-section">
            <h3>APIæ¥å£æµ‹è¯•</h3>
            
            <div class="api-test">
                <h4>1. æµ‹è¯•ä¸å¸¦æœˆä»½å‚æ•°çš„æ¥å£</h4>
                <div class="url-display">GET /api/v1/attendance/status/load</div>
                <button onclick="testLoadWithoutMonth()">æµ‹è¯•è°ƒç”¨</button>
                <div id="response1" class="response-display"></div>
            </div>
            
            <div class="api-test">
                <h4>2. æµ‹è¯•å¸¦æœˆä»½å‚æ•°çš„æ¥å£</h4>
                <div class="url-display">GET /api/v1/attendance/status/load/2026-01</div>
                <button onclick="testLoadWithMonth('2026-01')">æµ‹è¯• 2026-01</button>
                <button onclick="testLoadWithMonth('2025-12')">æµ‹è¯• 2025-12</button>
                <div id="response2" class="response-display"></div>
            </div>
            
            <div class="api-test">
                <h4>3. æµ‹è¯•ç”¨æˆ·ID+æœˆä»½æ ¼å¼</h4>
                <div class="url-display">GET /api/v1/attendance/status/load/user123**2026-01</div>
                <button onclick="testLoadWithUserMonth('user123**2026-01')">æµ‹è¯•ç”¨æˆ·+æœˆä»½</button>
                <div id="response3" class="response-display"></div>
            </div>
        </div>

        <div class="demo-section">
            <h3>å‰ç«¯è°ƒç”¨é€»è¾‘æµ‹è¯•</h3>
            <button onclick="testFrontendLogic()">æµ‹è¯•å‰ç«¯è°ƒç”¨é€»è¾‘</button>
            <button onclick="testGlobalMonthChange()">æµ‹è¯•å…¨å±€æœˆä»½å˜æ›´</button>
            <button onclick="clearLogs()">æ¸…é™¤æ—¥å¿—</button>
        </div>
        
        <div id="logs"></div>
    </div>

    <script>
        function log(message, type = 'info') {
            const logs = document.getElementById('logs');
            const div = document.createElement('div');
            div.className = `log ${type}`;
            div.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            logs.appendChild(div);
            logs.scrollTop = logs.scrollHeight;
        }

        function clearLogs() {
            document.getElementById('logs').innerHTML = '';
        }

        async function testLoadWithoutMonth() {
            log('å¼€å§‹æµ‹è¯•ä¸å¸¦æœˆä»½å‚æ•°çš„loadæ¥å£...', 'info');
            
            try {
                const response = await fetch('/api/v1/attendance/status/load');
                const data = await response.json();
                
                document.getElementById('response1').innerHTML = 
                    `<strong>çŠ¶æ€:</strong> ${response.status}<br>` +
                    `<strong>å“åº”:</strong> <pre>${JSON.stringify(data, null, 2)}</pre>`;
                
                if (response.ok) {
                    log('âœ… ä¸å¸¦æœˆä»½å‚æ•°çš„æ¥å£è°ƒç”¨æˆåŠŸ', 'success');
                } else {
                    log(`âŒ æ¥å£è°ƒç”¨å¤±è´¥: ${response.status}`, 'error');
                }
            } catch (error) {
                log(`âŒ æ¥å£è°ƒç”¨å¼‚å¸¸: ${error.message}`, 'error');
                document.getElementById('response1').innerHTML = `<strong>é”™è¯¯:</strong> ${error.message}`;
            }
        }

        async function testLoadWithMonth(month) {
            log(`å¼€å§‹æµ‹è¯•å¸¦æœˆä»½å‚æ•°çš„loadæ¥å£: ${month}`, 'info');
            
            try {
                const url = `/api/v1/attendance/status/load/${month}`;
                log(`è¯·æ±‚URL: ${url}`, 'info');
                
                const response = await fetch(url);
                const data = await response.json();
                
                document.getElementById('response2').innerHTML = 
                    `<strong>URL:</strong> ${url}<br>` +
                    `<strong>çŠ¶æ€:</strong> ${response.status}<br>` +
                    `<strong>å“åº”:</strong> <pre>${JSON.stringify(data, null, 2)}</pre>`;
                
                if (response.ok) {
                    log(`âœ… æœˆä»½å‚æ•° ${month} çš„æ¥å£è°ƒç”¨æˆåŠŸ`, 'success');
                    if (data.data) {
                        log(`âœ… è¿”å›æ•°æ®åŒ…å« ${Object.keys(data.data).length} ä¸ªæœˆä»½`, 'success');
                    }
                } else {
                    log(`âŒ æ¥å£è°ƒç”¨å¤±è´¥: ${response.status}`, 'error');
                }
            } catch (error) {
                log(`âŒ æ¥å£è°ƒç”¨å¼‚å¸¸: ${error.message}`, 'error');
                document.getElementById('response2').innerHTML = `<strong>é”™è¯¯:</strong> ${error.message}`;
            }
        }

        async function testLoadWithUserMonth(pathSegment) {
            log(`å¼€å§‹æµ‹è¯•ç”¨æˆ·+æœˆä»½æ ¼å¼çš„loadæ¥å£: ${pathSegment}`, 'info');
            
            try {
                const url = `/api/v1/attendance/status/load/${pathSegment}`;
                log(`è¯·æ±‚URL: ${url}`, 'info');
                
                const response = await fetch(url);
                const data = await response.json();
                
                document.getElementById('response3').innerHTML = 
                    `<strong>URL:</strong> ${url}<br>` +
                    `<strong>çŠ¶æ€:</strong> ${response.status}<br>` +
                    `<strong>å“åº”:</strong> <pre>${JSON.stringify(data, null, 2)}</pre>`;
                
                if (response.ok) {
                    log(`âœ… ç”¨æˆ·+æœˆä»½æ ¼å¼ ${pathSegment} çš„æ¥å£è°ƒç”¨æˆåŠŸ`, 'success');
                } else {
                    log(`âŒ æ¥å£è°ƒç”¨å¤±è´¥: ${response.status}`, 'error');
                }
            } catch (error) {
                log(`âŒ æ¥å£è°ƒç”¨å¼‚å¸¸: ${error.message}`, 'error');
                document.getElementById('response3').innerHTML = `<strong>é”™è¯¯:</strong> ${error.message}`;
            }
        }

        function testFrontendLogic() {
            log('å¼€å§‹æµ‹è¯•å‰ç«¯è°ƒç”¨é€»è¾‘...', 'info');
            
            // æ¨¡æ‹Ÿå‰ç«¯é€»è¾‘
            const globalMonth = '2026-01';
            const loadUrl = globalMonth 
                ? `/api/v1/attendance/status/load/${globalMonth}`
                : "/api/v1/attendance/status/load";
            
            log(`å…¨å±€æœˆä»½: ${globalMonth}`, 'info');
            log(`ç”Ÿæˆçš„URL: ${loadUrl}`, 'info');
            
            // éªŒè¯URLæ ¼å¼
            if (loadUrl.includes(globalMonth)) {
                log('âœ… URLæ­£ç¡®åŒ…å«æœˆä»½å‚æ•°', 'success');
            } else {
                log('âŒ URLæœªåŒ…å«æœˆä»½å‚æ•°', 'error');
            }
            
            // æ¨¡æ‹ŸuseEffectè§¦å‘æ¡ä»¶
            const hasInitialized = true;
            const shouldReload = hasInitialized && globalMonth;
            
            if (shouldReload) {
                log('âœ… useEffectåº”è¯¥è§¦å‘é‡æ–°åŠ è½½', 'success');
            } else {
                log('âŒ useEffectä¸ä¼šè§¦å‘é‡æ–°åŠ è½½', 'warning');
            }
        }

        function testGlobalMonthChange() {
            log('å¼€å§‹æµ‹è¯•å…¨å±€æœˆä»½å˜æ›´é€»è¾‘...', 'info');
            
            // æ¨¡æ‹Ÿæœˆä»½å˜æ›´åœºæ™¯
            const scenarios = [
                { from: null, to: '2026-01', desc: 'åˆå§‹åŠ è½½' },
                { from: '2026-01', to: '2026-02', desc: 'æœˆä»½åˆ‡æ¢' },
                { from: '2026-02', to: '2025-12', desc: 'è·¨å¹´åˆ‡æ¢' }
            ];
            
            scenarios.forEach(({ from, to, desc }) => {
                log(`ğŸ”„ ${desc}: ${from || 'null'} -> ${to}`, 'info');
                
                // æ¨¡æ‹ŸURLç”Ÿæˆ
                const newUrl = to ? `/api/v1/attendance/status/load/${to}` : '/api/v1/attendance/status/load';
                log(`ç”ŸæˆURL: ${newUrl}`, 'info');
                
                // æ¨¡æ‹ŸuseEffectè§¦å‘
                const shouldTrigger = from !== null && to; // å·²åˆå§‹åŒ–ä¸”æœ‰æ–°æœˆä»½
                if (shouldTrigger) {
                    log('âœ… åº”è¯¥è§¦å‘é‡æ–°åŠ è½½', 'success');
                } else {
                    log('â„¹ï¸ é¦–æ¬¡åŠ è½½æˆ–æ— æœˆä»½', 'info');
                }
            });
        }

        // é¡µé¢åŠ è½½æ—¶çš„åˆå§‹åŒ–
        window.onload = function() {
            log('è€ƒå‹¤Loadæ¥å£æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ', 'success');
            log('ä¿®å¤å†…å®¹:', 'info');
            log('1. åœ¨loadæ¥å£URLä¸­æ·»åŠ æœˆä»½å‚æ•°', 'info');
            log('2. æ·»åŠ globalMonthå˜åŒ–æ—¶çš„é‡æ–°åŠ è½½é€»è¾‘', 'info');
            log('3. ç¡®ä¿useEffectæ­£ç¡®è§¦å‘APIè°ƒç”¨', 'info');
        };
    </script>
</body>
</html>