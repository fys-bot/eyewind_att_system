<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è€ƒå‹¤é¡µé¢ä¼˜åŒ–éªŒè¯</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: #f8fafc;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .optimization {
            background: #dcfce7;
            border: 1px solid #16a34a;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
        }
        .log { 
            background: #f1f5f9; 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 4px; 
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        .success { color: #059669; }
        .info { color: #0284c7; }
        .warning { color: #d97706; }
        .error { color: #dc2626; }
        button { 
            padding: 8px 16px; 
            margin: 5px; 
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: white;
            cursor: pointer;
        }
        button:hover {
            background: #f9fafb;
        }
        .code-block {
            background: #1e293b;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
            margin: 10px 0;
            overflow-x: auto;
        }
        .feature-demo {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ è€ƒå‹¤é¡µé¢ä¼˜åŒ–åŠŸèƒ½éªŒè¯</h1>
        
        <div class="optimization">
            <h3>âœ… ä¸‰å¤§ä¼˜åŒ–åŠŸèƒ½</h3>
            <ol>
                <li><strong>ç¼“å­˜ä¼˜åŒ–ï¼š</strong>å¦‚æœç¼“å­˜ä¸­å·²æœ‰å‘˜å·¥æ•°æ®å’Œtokenï¼Œè·³è¿‡é‡å¤APIè°ƒç”¨ï¼Œç›´æ¥è°ƒç”¨loadæ¥å£</li>
                <li><strong>å‹å¥½é”™è¯¯æç¤ºï¼š</strong>404æ—¶æ˜¾ç¤º"XXæœˆè¿˜æœªé…ç½®è€ƒå‹¤ç¡®è®¤ä¿¡æ¯ï¼Œè¯·ç§»æ­¥è€ƒå‹¤ä»ªè¡¨ç›˜è®¾ç½®å¹¶ç¡®è®¤"</li>
                <li><strong>åˆ›å»ºå…¥å£ï¼š</strong>404é”™è¯¯é¡µé¢å¢åŠ "åˆ›å»ºè€ƒå‹¤ç¡®è®¤ï¼ˆä¸Šä¼ ï¼‰"æŒ‰é’®</li>
            </ol>
        </div>
        
        <div class="test-section">
            <h3>ğŸ§ª ç¼“å­˜ä¼˜åŒ–æµ‹è¯•</h3>
            <div class="feature-demo">
                <h4>ç¼“å­˜é€»è¾‘ï¼š</h4>
                <ul>
                    <li>é¦–æ¬¡è®¿é—®ï¼šè°ƒç”¨Token + Employee + Load API</li>
                    <li>5åˆ†é’Ÿå†…å†æ¬¡è®¿é—®ï¼šåªè°ƒç”¨Load API</li>
                    <li>ç¼“å­˜è¿‡æœŸåï¼šé‡æ–°è°ƒç”¨æ‰€æœ‰API</li>
                </ul>
            </div>
            <button onclick="testCacheOptimization()">æµ‹è¯•ç¼“å­˜ä¼˜åŒ–</button>
            <button onclick="simulateCache()">æ¨¡æ‹Ÿç¼“å­˜åœºæ™¯</button>
        </div>
        
        <div class="test-section">
            <h3>ğŸ’¬ å‹å¥½é”™è¯¯æç¤ºæµ‹è¯•</h3>
            <div class="feature-demo">
                <h4>404é”™è¯¯ä¿¡æ¯ä¼˜åŒ–ï¼š</h4>
                <p><strong>æ—§æç¤ºï¼š</strong>"å½“å‰æœˆä»½æ²¡æœ‰è€ƒå‹¤æ•°æ®"</p>
                <p><strong>æ–°æç¤ºï¼š</strong>"2026å¹´1æœˆè¿˜æœªé…ç½®è€ƒå‹¤ç¡®è®¤ä¿¡æ¯ï¼Œè¯·ç§»æ­¥è€ƒå‹¤ä»ªè¡¨ç›˜è®¾ç½®å¹¶ç¡®è®¤"</p>
            </div>
            <button onclick="test404Message()">æµ‹è¯•404é”™è¯¯ä¿¡æ¯</button>
        </div>
        
        <div class="test-section">
            <h3>ğŸ¯ åˆ›å»ºå…¥å£æµ‹è¯•</h3>
            <div class="feature-demo">
                <h4>404é¡µé¢æ–°å¢åŠŸèƒ½ï¼š</h4>
                <ul>
                    <li>ğŸ“¤ <strong>åˆ›å»ºè€ƒå‹¤ç¡®è®¤</strong> æŒ‰é’®ï¼ˆç»¿è‰²ï¼‰</li>
                    <li>ğŸ”„ <strong>é‡æ–°åŠ è½½</strong> æŒ‰é’®ï¼ˆè“è‰²ï¼‰</li>
                </ul>
                <p>ç‚¹å‡»"åˆ›å»ºè€ƒå‹¤ç¡®è®¤"ä¼šè·³è½¬åˆ°ä¸Šä¼ é¡µé¢ï¼Œå°±åƒä»¥å‰ä¸€æ ·</p>
            </div>
            <button onclick="testCreateEntry()">æµ‹è¯•åˆ›å»ºå…¥å£</button>
        </div>
        
        <div class="test-section">
            <h3>ğŸ“‹ ä¼˜åŒ–å‰åå¯¹æ¯”</h3>
            
            <h4>ç¼“å­˜ä¼˜åŒ–å¯¹æ¯”ï¼š</h4>
            <div class="code-block">
// ä¼˜åŒ–å‰ï¼šæ¯æ¬¡éƒ½è°ƒç”¨æ‰€æœ‰API
Token API â†’ Employee API â†’ Load API

// ä¼˜åŒ–åï¼šåˆ©ç”¨ç¼“å­˜
é¦–æ¬¡è®¿é—®: Token API â†’ Employee API â†’ Load API
å†æ¬¡è®¿é—®: Load API (è·³è¿‡Tokenå’ŒEmployee)
            </div>
            
            <h4>é”™è¯¯æç¤ºå¯¹æ¯”ï¼š</h4>
            <div class="code-block">
// ä¼˜åŒ–å‰
"å½“å‰æœˆä»½æ²¡æœ‰è€ƒå‹¤æ•°æ®"

// ä¼˜åŒ–å  
"2026å¹´1æœˆè¿˜æœªé…ç½®è€ƒå‹¤ç¡®è®¤ä¿¡æ¯ï¼Œè¯·ç§»æ­¥è€ƒå‹¤ä»ªè¡¨ç›˜è®¾ç½®å¹¶ç¡®è®¤"
+ [åˆ›å»ºè€ƒå‹¤ç¡®è®¤] [é‡æ–°åŠ è½½] æŒ‰é’®
            </div>
        </div>
        
        <div id="logs"></div>
    </div>

    <script>
        function log(message, type = 'info') {
            const logs = document.getElementById('logs');
            const div = document.createElement('div');
            div.className = `log ${type}`;
            div.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            logs.appendChild(div);
            logs.scrollTop = logs.scrollHeight;
        }

        function clearLogs() {
            document.getElementById('logs').innerHTML = '';
        }

        function testCacheOptimization() {
            log('ğŸ§ª å¼€å§‹æµ‹è¯•ç¼“å­˜ä¼˜åŒ–...', 'info');
            
            // æ¨¡æ‹Ÿç¼“å­˜æ£€æŸ¥é€»è¾‘
            const currentCompany = 'eyewind';
            const cacheKey = `employees_${currentCompany}`;
            const CACHE_DURATION = 5 * 60 * 1000; // 5åˆ†é’Ÿ
            
            // æ¨¡æ‹Ÿç¼“å­˜çŠ¶æ€
            const mockCache = new Map();
            const now = Date.now();
            
            log('åœºæ™¯1: é¦–æ¬¡è®¿é—®ï¼ˆæ— ç¼“å­˜ï¼‰', 'info');
            log('  - ç¼“å­˜æ£€æŸ¥: æ— ç¼“å­˜æ•°æ®', 'warning');
            log('  - APIè°ƒç”¨: Token â†’ Employee â†’ Load', 'info');
            log('  - ç¼“å­˜æ›´æ–°: ä¿å­˜å‘˜å·¥æ•°æ®åˆ°ç¼“å­˜', 'success');
            
            // æ¨¡æ‹Ÿè®¾ç½®ç¼“å­˜
            mockCache.set(cacheKey, { data: [], timestamp: now });
            
            log('åœºæ™¯2: 5åˆ†é’Ÿå†…å†æ¬¡è®¿é—®ï¼ˆæœ‰æ•ˆç¼“å­˜ï¼‰', 'info');
            const cached = mockCache.get(cacheKey);
            if (cached && (now - cached.timestamp) < CACHE_DURATION) {
                log('  - ç¼“å­˜æ£€æŸ¥: å‘ç°æœ‰æ•ˆç¼“å­˜', 'success');
                log('  - APIè°ƒç”¨: ä»…Loadæ¥å£', 'success');
                log('  - æ€§èƒ½æå‡: è·³è¿‡Tokenå’ŒEmployee API', 'success');
            }
            
            log('åœºæ™¯3: ç¼“å­˜è¿‡æœŸåè®¿é—®', 'info');
            const expiredTime = now - (6 * 60 * 1000); // 6åˆ†é’Ÿå‰
            mockCache.set(cacheKey, { data: [], timestamp: expiredTime });
            const expiredCache = mockCache.get(cacheKey);
            if (!expiredCache || (now - expiredCache.timestamp) >= CACHE_DURATION) {
                log('  - ç¼“å­˜æ£€æŸ¥: ç¼“å­˜å·²è¿‡æœŸ', 'warning');
                log('  - APIè°ƒç”¨: Token â†’ Employee â†’ Load', 'info');
                log('  - ç¼“å­˜æ›´æ–°: åˆ·æ–°ç¼“å­˜æ•°æ®', 'success');
            }
            
            log('âœ… ç¼“å­˜ä¼˜åŒ–æµ‹è¯•å®Œæˆ', 'success');
        }

        function simulateCache() {
            log('ğŸ”„ æ¨¡æ‹Ÿå®é™…ç¼“å­˜åœºæ™¯...', 'info');
            
            log('1. ç”¨æˆ·é¦–æ¬¡ç‚¹å‡»"è€ƒå‹¤ç¡®è®¤"', 'info');
            log('   â†’ æ£€æŸ¥å‘˜å·¥æ•°æ®ç¼“å­˜: ä¸å­˜åœ¨', 'warning');
            log('   â†’ è°ƒç”¨fetchAllEmployees: Token + Employee API', 'info');
            log('   â†’ è°ƒç”¨Load API', 'info');
            log('   â†’ ç¼“å­˜å‘˜å·¥æ•°æ®ï¼ˆ5åˆ†é’Ÿæœ‰æ•ˆæœŸï¼‰', 'success');
            
            log('2. ç”¨æˆ·åˆ‡æ¢æœˆä»½æˆ–åˆ·æ–°é¡µé¢ï¼ˆ5åˆ†é’Ÿå†…ï¼‰', 'info');
            log('   â†’ æ£€æŸ¥å‘˜å·¥æ•°æ®ç¼“å­˜: å­˜åœ¨ä¸”æœ‰æ•ˆ', 'success');
            log('   â†’ è·³è¿‡Tokenå’ŒEmployee APIè°ƒç”¨', 'success');
            log('   â†’ ç›´æ¥è°ƒç”¨Load API', 'info');
            log('   â†’ æ€§èƒ½æå‡: å‡å°‘2ä¸ªAPIè°ƒç”¨', 'success');
            
            log('3. 5åˆ†é’Ÿåå†æ¬¡è®¿é—®', 'info');
            log('   â†’ æ£€æŸ¥å‘˜å·¥æ•°æ®ç¼“å­˜: å·²è¿‡æœŸ', 'warning');
            log('   â†’ é‡æ–°è°ƒç”¨æ‰€æœ‰API', 'info');
            log('   â†’ æ›´æ–°ç¼“å­˜', 'success');
        }

        function test404Message() {
            log('ğŸ’¬ å¼€å§‹æµ‹è¯•404é”™è¯¯ä¿¡æ¯ä¼˜åŒ–...', 'info');
            
            const globalMonth = '2026-01';
            const monthText = globalMonth.replace('-', 'å¹´') + 'æœˆ';
            const newErrorMessage = `${monthText}è¿˜æœªé…ç½®è€ƒå‹¤ç¡®è®¤ä¿¡æ¯ï¼Œè¯·ç§»æ­¥è€ƒå‹¤ä»ªè¡¨ç›˜è®¾ç½®å¹¶ç¡®è®¤`;
            
            log('æ—§é”™è¯¯ä¿¡æ¯:', 'warning');
            log('  "å½“å‰æœˆä»½æ²¡æœ‰è€ƒå‹¤æ•°æ®"', 'error');
            
            log('æ–°é”™è¯¯ä¿¡æ¯:', 'success');
            log(`  "${newErrorMessage}"`, 'success');
            
            log('ä¼˜åŒ–æ•ˆæœ:', 'info');
            log('  âœ… æ˜ç¡®æŒ‡å‡ºå…·ä½“æœˆä»½', 'success');
            log('  âœ… è¯´æ˜é—®é¢˜åŸå› ï¼ˆæœªé…ç½®ï¼‰', 'success');
            log('  âœ… æä¾›è§£å†³æ–¹æ¡ˆï¼ˆç§»æ­¥ä»ªè¡¨ç›˜ï¼‰', 'success');
            log('  âœ… è¯­è¨€æ›´å‹å¥½å’Œä¸“ä¸š', 'success');
        }

        function testCreateEntry() {
            log('ğŸ¯ å¼€å§‹æµ‹è¯•åˆ›å»ºå…¥å£åŠŸèƒ½...', 'info');
            
            log('404é”™è¯¯é¡µé¢æ–°å¢å…ƒç´ :', 'info');
            log('  ğŸ“¤ åˆ›å»ºè€ƒå‹¤ç¡®è®¤ æŒ‰é’®ï¼ˆç»¿è‰²ï¼‰', 'success');
            log('     â†’ ç‚¹å‡»åè·³è½¬åˆ°CreateAttendanceWizard', 'info');
            log('     â†’ åŠŸèƒ½ä¸ä»¥å‰å®Œå…¨ä¸€æ ·', 'info');
            
            log('  ğŸ”„ é‡æ–°åŠ è½½ æŒ‰é’®ï¼ˆè“è‰²ï¼‰', 'success');
            log('     â†’ é‡æ–°è°ƒç”¨loadDataå‡½æ•°', 'info');
            log('     â†’ æ¸…é™¤é”™è¯¯çŠ¶æ€', 'info');
            
            log('é¡µé¢å¸ƒå±€:', 'info');
            log('  - é”™è¯¯ä¿¡æ¯å±…ä¸­æ˜¾ç¤º', 'info');
            log('  - ä¸¤ä¸ªæŒ‰é’®æ°´å¹³æ’åˆ—', 'info');
            log('  - åˆ›å»ºæŒ‰é’®æ›´çªå‡ºï¼ˆç»¿è‰²ï¼‰', 'success');
            
            log('ç”¨æˆ·ä½“éªŒæå‡:', 'success');
            log('  âœ… 404æ—¶ä¸å†æ˜¯æ­»èƒ¡åŒ', 'success');
            log('  âœ… æä¾›æ˜ç¡®çš„æ“ä½œé€‰é¡¹', 'success');
            log('  âœ… ä¿æŒåŸæœ‰åŠŸèƒ½å®Œæ•´æ€§', 'success');
        }

        // é¡µé¢åŠ è½½æ—¶çš„åˆå§‹åŒ–
        window.onload = function() {
            log('è€ƒå‹¤é¡µé¢ä¼˜åŒ–åŠŸèƒ½éªŒè¯å·¥å…·åŠ è½½å®Œæˆ', 'success');
            log('', 'info');
            log('ğŸ¯ æœ¬æ¬¡ä¼˜åŒ–çš„ä¸‰å¤§åŠŸèƒ½:', 'info');
            log('1. ç¼“å­˜ä¼˜åŒ– - é¿å…é‡å¤è°ƒç”¨Tokenå’ŒEmployee API', 'success');
            log('2. å‹å¥½æç¤º - 404é”™è¯¯ä¿¡æ¯æ›´æ¸…æ™°å’Œæœ‰æŒ‡å¯¼æ€§', 'success');
            log('3. åˆ›å»ºå…¥å£ - 404é¡µé¢å¢åŠ åˆ›å»ºè€ƒå‹¤ç¡®è®¤æŒ‰é’®', 'success');
            log('', 'info');
            log('ğŸš€ é¢„æœŸæ•ˆæœ:', 'info');
            log('â€¢ æ€§èƒ½æå‡: ç¼“å­˜æœ‰æ•ˆæ—¶å‡å°‘APIè°ƒç”¨', 'success');
            log('â€¢ ç”¨æˆ·ä½“éªŒ: é”™è¯¯ä¿¡æ¯æ›´å‹å¥½', 'success');
            log('â€¢ åŠŸèƒ½å®Œæ•´: 404æ—¶å¯ç›´æ¥åˆ›å»ºè€ƒå‹¤ç¡®è®¤', 'success');
            log('', 'info');
            log('ç°åœ¨å¯ä»¥å¼€å§‹éªŒè¯ä¼˜åŒ–æ•ˆæœ...', 'info');
        };
    </script>
</body>
</html>